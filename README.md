# Structure & Logic

Скрипт предназначен для создания структуры БД пиццерии: таблиц, ограничений целостности, индексов, представлений и базовой транзакционной логики.

## Назначение

Скрипт позволяет:

- развернуть базу данных с нуля;
    
- воспроизвести архитектуру проекта в тестовой или учебной среде;
    
- продемонстрировать подход к проектированию транзакционной и аналитической части БД.
    

## Структура скрипта

SQL-код организован в логическом порядке:

1. создание основных сущностей и связей;
    
2. определение ограничений целостности данных;
    
3. создание индексов для оптимизации запросов;
    
4. создание аналитических представлений;
    
5. использование транзакций для атомарных операций.
    

## Индексы

Индексы добавлены с учётом типовых сценариев использования БД:

- **`idx_orders_date_time`**  
    Используется для фильтрации и агрегации заказов по дате и времени (дневные и месячные отчёты).
    
- **`idx_orders_customer_date`**  
    Оптимизирует выборки заказов конкретного клиента за период времени.
    
- **`idx_order_items_pizza`**  
    Ускоряет агрегации по товарам при расчёте популярности и выручки.
    
- **`idx_customer_reg_date`**  
    Используется при анализе новых клиентов и расчётах клиентской динамики.
    

## Представления

Для аналитики используются SQL-представления, изолирующие бизнес-логику:

- **`last_day_sales`**  
    Агрегированные показатели продаж за день (количество заказов, выручка).
    
- **`new_customers_per_month`**  
    Количество новых клиентов за последний месяц.
    
- **`total_orders`**  
    Популярность товаров по количеству заказов и сумме продаж.
    
- **`delivery_efficiency`**  
    Метрики работы курьеров (количество успешных, отмененных и суммарных доставок).
    
- **`unactive_clients`**  
    Клиенты, не совершавшие заказов за последний год.
    

## Транзакционная логика

Транзакции используются для обеспечения целостности данных при выполнении критичных операций:

- создание структуры БД выполняется атомарно;
    
- при ошибке выполнения изменения не фиксируются;
    
Это позволяет контролировать внесение изменений в БД и фиксировать их при корректной работе запроса.
